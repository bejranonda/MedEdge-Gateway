@namespace MedEdge.Dashboard.Shared
@inherits LayoutComponentBase
@implements IAsyncDisposable
@inject NavigationManager Navigation
@inject ISnackbar Snackbar
@inject IAuthenticationService AuthService

<MudThemeProvider Theme="theme" />
<MudDialogProvider />
<MudSnackbarProvider />

<div class="mud-layout-root">
    <MudAppBar Elevation="4" Class="mud-primary">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" @onclick="DrawerToggle" />
        <MudSpacer />
        <MudText Typo="Typo.h6" Class="mr-4">MedEdge Gateway - Medical Device Platform</MudText>
        @if (AuthService.IsAuthenticated)
        {
            <MudText Typo="Typo.body2" Class="mr-4">
                <MudIcon Icon="@Icons.Material.Filled.Person" Class="mr-1" />
                @AuthService.Username
            </MudText>
            <MudButton Variant="Variant.Text" Color="Color.Inherit" OnClick="HandleLogout" StartIcon="@Icons.Material.Filled.Logout">
                Logout
            </MudButton>
        }
        else
        {
            <MudIconButton Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit" Edge="Edge.End" />
        }
    </MudAppBar>

    <MudDrawer @bind-Open="drawerOpen" Elevation="1">
        <MudDrawerHeader>
            <MudText Typo="Typo.h5">Navigation</MudText>
        </MudDrawerHeader>
        <NavMenu />
    </MudDrawer>

    <MudMainContent>
        <div style="padding: 20px;">
            @Body
        </div>
    </MudMainContent>
</div>

<MudSnackbar Icon="@Icons.Material.Filled.Error" Color="Color.Error" />

@code {
    private bool drawerOpen = true;
    private MudTheme theme = new MudTheme
    {
        Palette = new PaletteLight
        {
            Primary = "#009639",        // Healthcare Green
            Secondary = "#F5F5F5",      // Light Gray
            Background = "#FFFFFF",     // White
            AppbarBackground = "#009639", // Healthcare Green
            Error = "#D32F2F",          // Alert Red
            Success = "#388E3C",        // Success Green
            Warning = "#F57C00"         // Warning Orange
        },
        PaletteDark = new PaletteDark
        {
            Primary = "#009639",
            Secondary = "#F5F5F5",
            Background = "#121212",
            AppbarBackground = "#009639",
            Error = "#D32F2F",
            Success = "#4CAF50",
            Warning = "#FF9800"
        }
    };

    private void DrawerToggle()
    {
        drawerOpen = !drawerOpen;
    }

    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        // Cleanup if needed
        await Task.CompletedTask;
    }
}
